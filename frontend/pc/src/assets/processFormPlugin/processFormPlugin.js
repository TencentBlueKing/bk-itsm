!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@blueking/user-selector"),require("@toast-ui/vue-editor"),require("@toast-ui/editor/dist/toastui-editor.css")):"function"==typeof define&&define.amd?define(["exports","@blueking/user-selector","@toast-ui/vue-editor","@toast-ui/editor/dist/toastui-editor.css"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).processFormPlugin={},e.BkUserSelector,e.vueEditor)}(this,(function(e,t,n){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=a(t);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function d(e,t,n,a,i,r,d){try{var o=e[r](d),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(a,i)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var r=e.apply(t,n);function o(e){d(r,a,i,o,l,"next",e)}function l(e){d(r,a,i,o,l,"throw",e)}o(void 0)}))}}function l(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function u(e){if(null===e)return null;if(["string","number","boolean","undefined","symbol"].includes(r(e)))return e;var t=Object.assign({},e);return Object.keys(t).forEach((function(n){return t[n]="object"===r(e[n])?u(e[n]):e[n]})),Array.isArray(e)?(t.length=e.length,Array.from(t)):t}var c=[{type:"STRING",name:"单行文本",default:"",comp:"Input"},{type:"TEXT",name:"多行文本",default:"",comp:"Textarea"},{type:"INT",name:"数字",default:0,comp:"Int"},{type:"DATE",name:"日期",default:"",comp:"Date"},{type:"DATETIME",name:"时间",default:"",comp:"Datetime"},{type:"TABLE",name:"表格",default:[],comp:"Table"},{type:"SELECT",name:"单选下拉框",default:"",comp:"Select"},{type:"INPUTSELECT",name:"可输入单选下拉框",default:"",comp:"InputSelect"},{type:"MULTISELECT",name:"多选下拉框",default:[],comp:"MultiSelect"},{type:"CHECKBOX",name:"复选框",default:[],comp:"Checkbox"},{type:"RADIO",name:"单选框",default:"",comp:"Radio"},{type:"MEMBER",name:"单选人员选择",default:[],comp:"Member"},{type:"MEMBERS",name:"多选人员选择",default:[],comp:"Members"},{type:"RICHTEXT",name:"富文本",default:"",comp:"RichText"},{type:"FILE",name:"附件上传",default:"",comp:"Upload"},{type:"IMAGE",name:"图片上传",default:"",comp:"ImageFile"},{type:"LINK",name:"链接",default:"",comp:"Link"},{type:"AUTO-NUMBER",name:"自动编号",default:"",comp:"AutoNumber"},{type:"DESC",name:"描述文本",default:"",comp:"Description"},{type:"FORMULA",name:"计算控件",default:"",comp:"Formula"}];function f(e,t,n,a,i,r,d,o,l,s){"boolean"!=typeof d&&(l=o,o=d,d=!1);const u="function"==typeof n?n.options:n;let c;if(e&&e.render&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0,i&&(u.functional=!0)),a&&(u._scopeId=a),r?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(r)},u._ssrRegister=c):t&&(c=d?function(e){t.call(this,s(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,o(e))}),c)if(u.functional){const e=u.render;u.render=function(t,n){return c.call(n),e(t,n)}}else{const e=u.beforeCreate;u.beforeCreate=e?[].concat(e,c):[c]}return n}var p={name:"AutoNumber"},v=function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"auto-number"},[e._v("--")])};v._withStripped=!0;var h=f({render:v,staticRenderFns:[]},undefined,p,"data-v-01c96718",false,undefined,!1,void 0,void 0,void 0),m={props:{useFixedDataSource:{type:Boolean,default:!1}},data:function(){return{sourceDataLoading:!1,sourceData:[],isOpenApi:""}},created:function(){this.isOpenApi=sessionStorage.getItem("isOpenApi"),this.setSourceData()},methods:{setSourceData:function(){if("CUSTOM"===this.field.source_type||this.useFixedDataSource)this.sourceData=this.field.choice;else{if("API"===this.field.source_type)return void this.setApiData();"WORKSHEET"===this.field.source_type&&this.setWorksheetData()}},setApiData:function(){var e=this;return o(regeneratorRuntime.mark((function t(){var n,a,i,r,d,o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.sourceDataLoading=!0,n=e.field,a=n.id,i=n.api_info,r=n.api_instance_id,d=n.kv_relation,o={id:a,api_instance_id:r,kv_relation:d,api_info:{api_instance_info:i,remote_api_info:i.remote_api_info}},t.next=6,e.$store.dispatch("setting/getSourceData",o);case 6:l=t.sent,e.sourceData=l.data.map((function(e){return{key:e.key,name:e.name}})),e.sourceDataLoading=!1,t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),console.error(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})))()},setWorksheetData:function(){var e=this;return o(regeneratorRuntime.mark((function t(){var n,a,i,r,d,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.sourceDataLoading=!0,n=e.field.meta.data_config,a=n.field,i=n.conditions,r=i.connector||i.expressions.every((function(e){return e}))?{token:e.field.token,fields:[a],conditions:i}:{token:e.field.token,fields:[a],conditions:{}},d="getWorksheetData",e.isOpenApi&&(d="getOpenApiWorksheetData"),t.next=8,e.$store.dispatch("setting/".concat(d),r);case 8:o=t.sent,e.sourceData=o.data.map((function(e){var t=e[a];return{key:t,name:t}})),e.sourceDataLoading=!1,t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),console.error(t.t0);case 16:case"end":return t.stop()}}),t,null,[[0,13]])})))()}}},b={name:"Checkbox",mixins:[m],props:{field:{type:Object,default:function(){return{}}},value:{type:[Array,String]},disabled:{type:Boolean,default:!1}},data:function(){return{val:Array.isArray(this.value)?l(this.value):[this.value]}},watch:{value:function(e){this.val=Array.isArray(e)?l(e):[e]}},methods:{getDisableStatus:function(e){return!!this.disabled||!(!("num_range"in this.field&&"number"==typeof this.field.num_range[1]&&Array.isArray(this.value)&&this.value.length>=this.field.num_range[1])||this.value.includes(e))},change:function(e){this.$emit("change",e)}}},y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"checkbox"},[n("bk-checkbox-group",{on:{change:e.change},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}},e._l(e.sourceData,(function(t){return n("bk-checkbox",{key:t.key,attrs:{value:t.key,disabled:e.getDisableStatus(t.key)}},[e._v("\n      "+e._s(t.name)+"\n    ")])})),1)],1)};y._withStripped=!0;var g=f({render:y,staticRenderFns:[]},undefined,b,"data-v-6115e2f7",false,undefined,!1,void 0,void 0,void 0),_={name:"CustomForm"},k=function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"custom-form"},[e._v("自定义表单组件")])};k._withStripped=!0;var S=f({render:k,staticRenderFns:[]},undefined,_,undefined,false,undefined,!1,void 0,void 0,void 0),w={name:"CustomTable"},E=function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"custom-table"},[e._v("自定义表格组件")])};E._withStripped=!0;var x=f({render:E,staticRenderFns:[]},undefined,w,undefined,false,undefined,!1,void 0,void 0,void 0),C={name:"Date",props:{field:{type:Object,default:function(){return{}}},value:{type:String,default:""},disabled:{type:Boolean,default:!1}},data:function(){return{val:this.value}},watch:{value:function(e){this.val=e}},methods:{change:function(e){this.$emit("change",e)}}},$=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"date"},[n("bk-date-picker",{attrs:{disabled:e.disabled},on:{change:e.change},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}})],1)};$._withStripped=!0;var F=f({render:$,staticRenderFns:[]},undefined,C,"data-v-343989f4",false,undefined,!1,void 0,void 0,void 0),R={name:"Datetime",props:{field:{type:Object,default:function(){return{}}},value:{type:String,default:""},disabled:{type:Boolean,default:!1}},data:function(){return{val:this.value}},watch:{value:function(e){this.val=e}},methods:{change:function(e){this.$emit("change",e)}}},D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"datetime"},[n("bk-date-picker",{attrs:{type:"datetime",disabled:e.disabled},on:{change:e.change},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}})],1)};D._withStripped=!0;var A=f({render:D,staticRenderFns:[]},undefined,R,"data-v-22d39ba2",false,undefined,!1,void 0,void 0,void 0),T={name:"Description",props:{field:{type:Object,default:function(){return{}}},value:{type:String,default:""},disabled:{type:Boolean,default:!1}}},B=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"desc"},[n("div",{staticClass:"content"},[e._v(e._s(e.value))])])};B._withStripped=!0;var O=f({render:B,staticRenderFns:[]},undefined,T,"data-v-16faf891",false,undefined,!1,void 0,void 0,void 0),I={name:"Formula"},M=function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"formula"},[e._v("--")])};M._withStripped=!0;var L=f({render:M,staticRenderFns:[]},undefined,I,"data-v-10ef1214",false,undefined,!1,void 0,void 0,void 0),j={name:"ImageFile",props:{field:{type:Object,default:function(){return{}}},value:{type:Array,default:function(){return[]}},disabled:{type:Boolean,default:!1},viewMode:{type:Boolean,default:!1}},data:function(){return{imgList:l(this.value)}},watch:{field:function(){this.imgList=l(this.value)}},methods:{change:function(e){var t=this;return o(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==(a=Array.prototype.slice.call(e.target.files)).length){n.next=3;break}return n.abrupt("return");case 3:t.$refs.file.value=null,a.forEach((function(e){t.uploadFile(e)}));case 5:case"end":return n.stop()}}),n)})))()},uploadFile:function(e){var t=this;return o(regeneratorRuntime.mark((function n(){var a,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,t.uploading=!0,(a=new FormData).append("field_file",e),n.next=6,t.$store.dispatch("common/uploadFile",a);case 6:i=n.sent,Object.keys(i.data.succeed_files).forEach((function(e){t.imgList.push(i.data.succeed_files[e])})),t.update(),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(0),console.error(n.t0);case 14:return n.prev=14,t.uploading=!1,n.finish(14);case 17:case"end":return n.stop()}}),n,null,[[0,11,14,17]])})))()},getFullPath:function(e){return"string"==typeof e?"".concat(window.location.origin).concat(window.SITE_URL).concat(e):"".concat(window.location.origin).concat(window.SITE_URL).concat(e.path)},handleDelete:function(e){this.imgList.splice(e,1),this.update()},update:function(){this.$emit("change",this.imgList)}}},U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"image-file"},[e.viewMode?e._e():n("div",{class:["image-upload-wrapper",{disabled:e.disabled}]},[e._m(0),e._v(" "),n("input",{ref:"file",staticClass:"upload-input",attrs:{type:"file",accept:".png, .jpeg, .jpg, .svg, .gif",multiple:!0,disabled:e.disabled},on:{change:e.change}})]),e._v(" "),e._l(e.imgList,(function(t,a){return n("div",{key:a,class:["image-item",{disabled:e.disabled||e.viewMode}]},[n("img",{attrs:{src:e.getFullPath(t)}}),e._v(" "),n("i",{staticClass:"delete-icon bk-icon icon-close",on:{click:function(t){return e.handleDelete(a)}}})])}))],2)};U._withStripped=!0;var N=f({render:U,staticRenderFns:[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"upload-text"},[n("i",{staticClass:"bk-icon icon-plus"}),e._v(" "),n("div",[e._v("点击上传")])])}]},undefined,j,undefined,false,undefined,!1,void 0,void 0,void 0),V={name:"Input",props:{field:{type:Object,default:function(){return{}}},value:{type:String,default:""},disabled:{type:Boolean,default:!1}},data:function(){return{val:this.value}},watch:{value:function(e){this.val=e}},methods:{change:function(e){this.$emit("change",e)}}},H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"input"},[n("bk-input",{attrs:{disabled:e.disabled},on:{change:e.change},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}})],1)};H._withStripped=!0;var P=f({render:H,staticRenderFns:[]},undefined,V,undefined,false,undefined,!1,void 0,void 0,void 0),q={name:"InputSelect",mixins:[m],props:{field:{type:Object,default:function(){return{}}},value:{type:String,default:""},disabled:{type:Boolean,default:!1}},data:function(){return{val:this.value}},watch:{value:function(e){this.val=e}},methods:{change:function(e){this.$emit("change",e)}}},X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"input-select"},[n("bk-select",{attrs:{searchable:!0,disabled:e.disabled,loading:e.sourceDataLoading},on:{change:e.change},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}},e._l(e.sourceData,(function(e){return n("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1)};X._withStripped=!0;var K=f({render:X,staticRenderFns:[]},undefined,q,undefined,false,undefined,!1,void 0,void 0,void 0),W={name:"Int",props:{field:{type:Object,default:function(){return{}}},value:{type:[Number,String],default:0},disabled:{type:Boolean,default:!1}},data:function(){return{val:this.value}},watch:{value:function(e){this.val=e}},methods:{change:function(e){this.$emit("change",e)}}},G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"int"},[n("bk-input",{attrs:{type:"number",disabled:e.disabled},on:{change:e.change},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}})],1)};G._withStripped=!0;var Y=f({render:G,staticRenderFns:[]},undefined,W,undefined,false,undefined,!1,void 0,void 0,void 0),z={name:"Link",props:{field:{type:Object,default:function(){return{}}},value:{type:String,default:""},disabled:{type:Boolean,default:!1}},data:function(){return{val:this.value}},watch:{value:function(e){this.val=e}},methods:{change:function(e){this.$emit("change",e)}}},J=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"link"},[n("bk-input",{attrs:{disabled:e.disabled},on:{change:e.change},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}})],1)};J._withStripped=!0;var Q=f({render:J,staticRenderFns:[]},undefined,z,undefined,false,undefined,!1,void 0,void 0,void 0),Z={name:"MemberSelector",components:{BkUserSelector:i.default},model:{prop:"value",event:"change"},props:{placeholder:{type:String,default:"请选择"},disabled:{type:Boolean,default:!1},multiple:{type:Boolean,default:!0},value:{type:Array,default:function(){return[]}},extCls:{type:String,default:""}},data:function(){return{users:[]}},computed:{api:function(){var e=window.BK_USER_MANAGE_HOST||location.origin;return"".concat(e,"/api/c/compapi/v2/usermanage/fs_list_users/")}},methods:{onChange:function(e){this.$emit("change",e)}}},ee=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:[e.extCls],attrs:{"test-posi-id":"bk-member-selector"}},[n("bk-user-selector",{staticClass:"ui-user-selector",attrs:{value:e.value,"fixed-height":!0,api:e.api,disabled:e.disabled,multiple:e.multiple,placeholder:e.placeholder},on:{change:e.onChange}})],1)};ee._withStripped=!0;var te=f({render:ee,staticRenderFns:[]},undefined,Z,"data-v-951d224e",false,undefined,!1,void 0,void 0,void 0),ne={name:"Member",components:{MemberSelect:te},props:{field:{type:Object,default:function(){return{}}},value:{type:Array,default:function(){return[]}},disabled:{type:Boolean,default:!1}},data:function(){return{val:l(this.value)}},watch:{value:function(e){this.val=l(e)}},methods:{change:function(e){this.$emit("change",e)}}},ae=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"member"},[n("member-select",{attrs:{disabled:e.disabled,multiple:!1},on:{change:e.change},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}})],1)};ae._withStripped=!0;var ie=f({render:ae,staticRenderFns:[]},undefined,ne,undefined,false,undefined,!1,void 0,void 0,void 0),re={name:"Members",components:{MemberSelect:te},props:{field:{type:Object,default:function(){return{}}},value:{type:Array,default:function(){return[]}},disabled:{type:Boolean,default:!1}},data:function(){return{val:l(this.value)}},watch:{value:function(e){this.val=l(e)}},methods:{change:function(e){this.$emit("change",e)}}},de=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"members"},[n("member-select",{attrs:{value:e.val,disabled:e.disabled},on:{change:e.change}})],1)};de._withStripped=!0;var oe=f({render:de,staticRenderFns:[]},undefined,re,undefined,false,undefined,!1,void 0,void 0,void 0),le={name:"MultiSelect",mixins:[m],props:{field:{type:Object,default:function(){return{}}},value:{type:Array,default:function(){return[]}},disabled:{type:Boolean,default:!1}},data:function(){return{val:l(this.value)}},watch:{value:function(e){this.val=l(e)}},methods:{getDisableStatus:function(e){return!!this.disabled||!(!("num_range"in this.field&&"number"==typeof this.field.num_range[1]&&Array.isArray(this.value)&&this.value.length>=this.field.num_range[1])||this.value.includes(e))},change:function(e){this.$emit("change",e)}}},se=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"multi-select"},[n("bk-select",{attrs:{multiple:!0,disabled:e.disabled,searchable:!0,loading:e.sourceDataLoading},on:{change:e.change},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}},e._l(e.sourceData,(function(t){return n("bk-option",{key:t.key,attrs:{id:t.key,disabled:e.getDisableStatus(t.key),name:t.name}})})),1)],1)};se._withStripped=!0;var ue=f({render:se,staticRenderFns:[]},undefined,le,undefined,false,undefined,!1,void 0,void 0,void 0),ce={name:"Radio",mixins:[m],props:{field:{type:Object,default:function(){return{}}},value:{type:String,default:""},disabled:{type:Boolean,default:!1}},data:function(){return{val:this.field.value||""}},watch:{value:function(e){this.val=e}},methods:{change:function(e){this.$emit("change",e)}}},fe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"radio"},[n("bk-radio-group",{attrs:{value:e.val},on:{change:e.change}},e._l(e.sourceData,(function(t){return n("bk-radio",{key:t.key,attrs:{value:t.key,disabled:e.disabled}},[e._v("\n      "+e._s(t.name)+"\n    ")])})),1)],1)};fe._withStripped=!0;var pe=f({render:fe,staticRenderFns:[]},undefined,ce,"data-v-50c6ddac",false,undefined,!1,void 0,void 0,void 0),ve={name:"RichTextEditor",components:{Editor:n.Editor,Viewer:n.Viewer},props:{preview:{type:Boolean,default:!1},value:{type:String,default:""},disabled:{type:Boolean,default:!1}},watch:{value:function(e){this.$refs.editor&&this.$refs.editor.invoke("setHTML",e)}},methods:{onEditorChange:function(){var e=this.$refs.editor.invoke("getHTML");this.$emit("change",e)}}},he=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"rich-text-editor"},[e.preview||e.disabled?n("viewer",{attrs:{"initial-value":e.value}}):n("editor",{ref:"editor",attrs:{"initial-edit-type":"wysiwyg",options:{autofocus:!1},"initial-value":e.value},on:{blur:e.onEditorChange}})],1)};he._withStripped=!0;var me={name:"RichText",components:{RichTextEditor:f({render:he,staticRenderFns:[]},undefined,ve,undefined,false,undefined,!1,void 0,void 0,void 0)},props:{field:{type:Object,default:function(){return{}}},value:{type:String,default:""},disabled:{type:Boolean,default:!1}},data:function(){return{val:this.value}},watch:{value:function(e){this.val=e}},methods:{change:function(e){this.$emit("change",e)}}},be=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"rich-text"},[n("rich-text-editor",{attrs:{value:e.val,disabled:e.disabled},on:{change:e.change}})],1)};be._withStripped=!0;var ye=f({render:be,staticRenderFns:[]},undefined,me,undefined,false,undefined,!1,void 0,void 0,void 0),ge={name:"Select",mixins:[m],props:{field:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:!1}},data:function(){return{val:this.field.val||this.field.value}},watch:{value:function(e){this.val=e}},methods:{change:function(e){this.$emit("change",e)}}},_e=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"select"},[n("bk-select",{attrs:{searchable:!0,disabled:e.disabled,loading:e.sourceDataLoading},on:{change:e.change},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}},e._l(e.sourceData,(function(e){return n("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1)};_e._withStripped=!0;var ke=f({render:_e,staticRenderFns:[]},undefined,ge,undefined,false,undefined,!1,void 0,void 0,void 0),Se={name:"Table",props:{field:{type:Object,default:function(){return{}}},value:{type:Array,default:function(){return[]}},viewMode:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},isHaveBorder:{type:Boolean,default:!0},maxHeight:[String,Number]},data:function(){return{val:this.getLocalVal(this.value)}},watch:{value:function(e){this.val=this.getLocalVal(e)}},methods:{getLocalVal:function(e){var t=u(e);if(0===t.length){var n={};this.field.choice.forEach((function(e){n[e.key]=""})),t.push(n)}return t},handleAddItem:function(e){var t={};this.field.choice.forEach((function(e){t[e.key]=""})),this.val.splice(e+1,0,t),this.change()},handleDelItem:function(e){0===e&&1===this.val.length||(this.val.splice(e,1),this.change())},change:function(){this.$emit("change",u(this.val))}}},we=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"table"},[n("bk-table",{attrs:{data:e.val,size:"small","outer-border":e.isHaveBorder,"max-height":e.maxHeight}},[e._l(e.field.choice,(function(t){return[n("bk-table-column",{key:t.key,attrs:{label:t.name},scopedSlots:e._u([{key:"default",fn:function(a){return[e.viewMode||e.disabled?n("span",[e._v(e._s(a.row[t.key]||"--"))]):n("bk-input",{on:{change:e.change},model:{value:a.row[t.key],callback:function(n){e.$set(a.row,t.key,n)},expression:"props.row[col.key]"}})]}}],null,!0)})]})),e._v(" "),e.viewMode||e.disabled?e._e():n("bk-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("bk-button",{attrs:{theme:"primary",text:!0},on:{click:function(n){return e.handleAddItem(t.$index)}}},[e._v("添加")]),e._v(" "),n("bk-button",{attrs:{theme:"primary",text:!0},on:{click:function(n){return e.handleDelItem(t.$index)}}},[e._v("删除")])]}}],null,!1,2093815655)})],2)],1)};we._withStripped=!0;var Ee=f({render:we,staticRenderFns:[]},undefined,Se,undefined,false,undefined,!1,void 0,void 0,void 0),xe={name:"Textarea",props:{field:{type:Object,default:function(){return{}}},value:{type:String,default:""},disabled:{type:Boolean,default:!1}},data:function(){return{val:this.value}},watch:{value:function(e){this.val=e}},methods:{change:function(e){this.$emit("change",e)}}},Ce=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"textarea"},[n("bk-input",{attrs:{type:"textarea",disabled:e.disabled},on:{change:e.change},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}})],1)};Ce._withStripped=!0;var $e=f({render:Ce,staticRenderFns:[]},undefined,xe,undefined,false,undefined,!1,void 0,void 0,void 0),Fe={name:"Tree",props:{field:{type:Object,default:function(){return{}}},value:{type:String,default:""}}},Re=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tree"},[t("bk-tree")],1)};Re._withStripped=!0;var De=f({render:Re,staticRenderFns:[]},undefined,Fe,undefined,false,undefined,!1,void 0,void 0,void 0),Ae={name:"Upload",props:{field:{type:Object,default:function(){return{}}},value:{type:Array,default:function(){return[]}},preview:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{url:this.preview?"":"".concat(window.SITE_URL,"api/misc/upload_file/"),files:l(this.value)}},watch:{value:function(e){this.files=l(e)}},methods:{customRequest:function(e){var t=this;console.log(e);var n=new FormData;return n.append("field_file",e.fileObj.origin),this.$store.dispatch("common/uploadFile",n).then((function(e){Object.keys(e.data.succeed_files).forEach((function(n){t.files.push(e.data.succeed_files[n]),t.update()}))}))},handleDelete:function(e,t){this.files=t.slice(0),this.update()},update:function(){this.$emit("change",this.files)}}},Te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"upload"},[n("bk-upload",{attrs:{name:"field_file",url:e.url,disabled:e.disabled,"custom-request":e.customRequest},on:{"on-delete":e.handleDelete}})],1)};Te._withStripped=!0;var Be={name:"FieldFormItem",components:{AutoNumber:h,Checkbox:g,CustomForm:S,CustomTable:x,Date:F,Datetime:A,Description:O,Formula:L,ImageFile:N,Input:P,InputSelect:K,Int:Y,Link:Q,Member:ie,Members:oe,MultiSelect:ue,Radio:pe,RichText:ye,Select:ke,Table:Ee,Textarea:$e,Tree:De,Upload:f({render:Te,staticRenderFns:[]},undefined,Ae,undefined,false,undefined,!1,void 0,void 0,void 0)},props:{field:{type:Object,default:function(){return{}}},value:{type:[String,Number,Boolean,Array],default:function(){var e=this;return u(c.find((function(t){return t.type===e.field.type})).default)}},showLabel:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},useFixedDataSource:{type:Boolean,default:!1}},computed:{fieldComp:function(){var e=this;return c.find((function(t){return t.type===e.field.type})).comp},isDisabled:function(){return this.field.is_readonly},isShow:function(){return!this.field.show_conditions||!this.field.show_conditions.connector}}},Oe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isShow?n("div",{class:["field-form-item",{"half-row":"COL_6"===e.field.layout}]},[e.showLabel&&"DESC"!==e.field.type?n("div",{class:["field-label",{required:"REQUIRE"===e.field.validate_type}]},[e.field.desc?n("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.field.desc,expression:"field.desc"}],staticClass:"label-text has-desc"},[e._v(e._s(e.field.name))]):n("span",{staticClass:"label-text"},[e._v(e._s(e.field.name))]),e._v(" "),e.field.tips?n("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.field.tips,expression:"field.tips"}],staticClass:"bk-icon icon-question-circle tips-icon"}):e._e()]):e._e(),e._v(" "),n("div",{staticClass:"field-form-content"},[n(e.fieldComp,{tag:"component",attrs:{field:e.field,disabled:e.isDisabled,"use-fixed-data-source":e.useFixedDataSource,value:e.value},on:{change:function(t){return e.$emit("change",t)}}})],1)]):e._e()};Oe._withStripped=!0;var Ie=f({render:Oe,staticRenderFns:[]},undefined,Be,"data-v-d7ab1420",false,undefined,!1,void 0,void 0,void 0),Me={name:"FormFields",components:{FieldFormItem:Ie},props:{fields:{type:Array,default:function(){return[]}},useFixedDataSource:{type:Boolean,default:!1},value:{type:Object,default:function(){return{}}}},data:function(){return{localValue:this.getFieldsValue(this.fields)}},watch:{fields:function(){this.localValue=this.getFieldsValue()},value:{handler:function(){this.localValue=this.getFieldsValue()},deep:!0}},methods:{getFieldsValue:function(){var e=this,t={};return this.fields.map((function(n){n.key in e.value?t[n.key]=u(e.value[n.key]):"default"in n&&(["MULTISELECT","CHECKBOX","MEMBER","MEMBERS","TABLE","IMAGE","FILE"].includes(n.type)?t[n.key]=n.default?n.default.split(","):[]:"DATETIME"===n.type&&"curTime"===n.default?t[n.key]=JSON.stringify(e.$dayjs(new Date).format("YYYY-MM-DD HH:mm:ss")):t[n.key]=n.default)})),t},handleChange:function(e,t){this.localValue[e]=t,this.$emit("change",e,u(this.localValue))}}},Le=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"form-fields"},e._l(e.fields,(function(t){return n("field-form-item",{key:t.key,attrs:{field:t,"use-fixed-data-source":e.useFixedDataSource,value:e.localValue[t.key]},on:{change:function(n){return e.handleChange(t.key,n)}}})})),1)};Le._withStripped=!0;var je=f({render:Le,staticRenderFns:[]},undefined,Me,"data-v-4de18339",false,undefined,!1,void 0,void 0,void 0),Ue={install:function(e){e.component("process-form-plugin",je)}},Ne={install:function(e){e.component("process-field-item",Ie)}};e.ProcessFieldItem=Ne,e.ProcessFormPlugin=Ue,Object.defineProperty(e,"__esModule",{value:!0})}));
